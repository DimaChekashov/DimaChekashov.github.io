generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  email         String   @unique
  passwordHash  String
  displayName   String?
  avatarUrl     String?
  bio           String?  @db.Text
  role          Role     @default(USER)
  isActive      Boolean  @default(true)
  posts         Post[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("users")
}

model Category {
 id          Int            @id @default(autoincrement())
 name        String 
 slug        String         @unique
 description String?
 parentId    Int?
 parent      Category?      @relation("CategoryToCategory", fields: [parentId], references: [id])
 children    Category[]     @relation("CategoryToCategory")
 posts       PostCategory[] 
 createdAt   DateTime       @default(now())

 @@map("categories")
}

model Post {
 id            Int            @id @default(autoincrement())
 title         String
 slug          String         @unique
 content       String
 excerpt       String?
 featuredImage String?
 authorId      Int 
 author        User           @relation(fields: [authorId], references: [id])
 status        PostStatus     @default(DRAFT)
 commentStatus Boolean        @default(true)
 publishedAt   DateTime?
 categories    PostCategory[] 
 tags          PostTag[]
 createdAt     DateTime       @default(now())
 updatedAt     DateTime       @updatedAt

 @@map("posts")
}

model PostCategory {
 postId     Int 
 сategoryId Int
 post       Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
 сategory   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

 @@id([postId, categoryId])
 @@map("post_categories")
}

model Tag {
 id        Int       @id @default(autoincrement())
 name      String
 slug      String    @unique
 posts     PostTag[]
 createdAt DateTime  @default(now())

 @@map("tags")
}

model PostTag {
 postId Int
 tagId  Int
 post   Post @relation(fields: [postId], references: [id], onDelete: Cascade)
 tag    Tag  @relation(fields: [tagId], references: [id], onDelete: Cascade)

 @@id([postId, tagId])
 @@map("post_tags")
}

model Comment {
 id        Int           @id @default(autoincrement())
 content   String
 postId    Int
 post      Post          @relation(fields: [postId], references: [id])
 userId    Int
 user      User          @relation(fields: [userId], references: [id])
 parentId  Int?
 parent    Comment?      @relation("CommentToComment", fields: [parentId], references: [id])
 children  Comment[]     @relation("CommentToComment")
 status    CommentStatus @default(PENDING)
 createdAt DateTime      @default(now())
 updatedAt DateTime      @updatedAt

 @@map("comments")
}

enum CommentStatus {
 APPROVED
 PENDING
 SPAM
 DELETED
}

enum PostStatus {
 PUBLISHED
 DRAFT
 ARCHIVED
}

enum Role {
 USER
 ADMIN
 MODERATOR
}